{% extends 'base_index.html' %}


{% block head %}
{{ super() }}
<link rel="stylesheet" href=".{{ url_for('.static', _external = False, filename='dist/lovely-tag.css') }}">
{% endblock %}

{% block container %}
{{ super() }}
<div class="page-header">
    <div class="row">
        <div class="col-xs-12 col-sm-12">
            <!-- H1 Title -->
            <h1><a href="{{ Comp.comp_url }}" name="{{ Comp.comp_record_hash }}">{{ Comp.comp_title }}</a></h1>
        </div>
        <div class="meta col-xs-12">
            <div class="tags">
                 <!-- https://www.jqueryscript.net/form/Simple-Animated-jQuery-Tags-Input-Plugin-Lovely-Tag.html -->
                {% for tag1 in Comp.comp_scenario %}
                    <span class="tag tag-{{ tag1 }}">{{ type_dict[ tag1 ] }}</span>
                {% endfor %}
                {% for tag2 in Comp.data_feature %}
                <span class="tag">{{ tag2 }}</span>
                {% endfor %}
                 <!-- <span class="tag to-be-checked">Hah, I can be checked</span> 
                 <span class="tag to-be-crossed">or crossed</span>  -->
            </div>
        </div>
    </div>
    <div class="row">
        <div class="meta col-xs-12">
            <!-- Export all deadlines to
            <a href="https://calendar.google.com/calendar/r?cid=http://aideadlin.es/ai-deadlines.ics">Google Calendar</a>
             . -->
            <p id="system-time"></p>
        </div>
    </div>
</div>

<!-- Begin: Main content -->
<div id="{{ Comp.comp_record_hash }}"
    class="{{ '-Comp '.join(Comp.comp_scenario) }}-comp {% if Comp.prize_currency %}{% else %}un{% endif %}rewarded-comp">
    <div class="row">
        <div class="col-xs-12 col-sm-6">
            <a href="{{ Comp.comp_url }}" name="{{ Comp.comp_record_hash }}">
                <b>{% if Comp.comp_subtitle %}{{ Comp.comp_subtitle }}{% else %}{% endif %}</b></a>
            <div class="meta">{{ Comp.comp_range }}
                // Host by 
                {% for host in Comp.comp_host %}
                {% if loop.index > 1 %}
                &
                {% endif %}
                <a href="{{ host.comp_host_url }}" style="background-color:#CCFF66">{{ host.comp_host_name }}</a>
                {% endfor %}
                {% if Comp.prize_currency %}
                // Prize: {{ Comp.prize_amount }} {{ Comp.prize_currency }}
                {% else %}
                {% endif %}</div>
            {% if Comp.comp_description %}
             <div class="note"><b>Note</b>: {{ Comp.comp_description | safe }} <!-- safe 渲染时不转义 -->
                <!-- More info <a href="http://baidu.com">here</a> -->
            </div>
            {% endif %}
            
            <hr>
            <!-- Show deadline -->
            {% if Comp.deadline != 'No deadline' %}
            <span class="timer"></span>
            <div class="deadline">
                <div>Entry Deadline: <span class="deadline-time"></span></div>
            </div>
            <div class="calendar"></div>
            {% else %}
            <div>No Deadline.</div>
            {% endif %}
            <hr>
            <!-- Show publish_time/update_time and contributor_id -->
            <div class="meta">
                {{ Comp.publish_time }} published by {{ Comp.contributor_id }}
                <br>
                {{ Comp.update_time }} updated by {{ Comp.contributor_id }}
            </div>
        </div>
        <div class="col-xs-12 col-sm-6">
            screenshot
        </div>
    </div>
    <hr>
</div>
<!-- End: Main content -->

<footer>
    <a href="/">DataSciComp</a>
    is maintained by
    <a href="https://github.com/iphysresearch">@Herb</a>
    .
</footer>
<hr>
{% endblock %}


{% block script_js %}
{{ super() }}
<!-- <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script> -->
<!-- <script src="https://libs.baidu.com/jquery/1.11.2/jquery.min.js"></script> -->
<!-- <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script> -->
<script src=".{{ url_for('static', _external = False, filename='dist/lovely-tag.js') }}"></script>

<script>
    // Begin: Deadline Control + Calendar
    $(function() {
      // https://github.com/carlsednaoui/add-to-calendar-buttons
          {% if Comp.deadline != 'No deadline' %}
        // adjust date according to deadline timezone
      //   var timezone = "Etc/GMT-8" ;
      //   var timezone = "Asia/Shanghai" ;
        var timezone = "{{ Comp.timezone }}" ;
        var compDate = moment.tz("{{ Comp.deadline }}", timezone);

        // render countdown timer
        $('#{{ Comp.comp_record_hash }} .timer').countdown(compDate.toDate(), function(event) {
          $(this).html(event.strftime('%D days %Hh %Mm %Ss'));
        });
        $('#{{ Comp.comp_record_hash }} .deadline-time').html(compDate.toString());
        // add calendar button
        var myCalendar = createCalendar({
          options: {
            class: 'calendar-obj',
            // You can pass an ID. If you don't, one will be generated for you
            id: '{{ Comp.comp_record_hash }}'
          },
          data: {
            // Event title
            title: '[Entry Deadline] {{ Comp.comp_title }}',
            // Event start date
            start: compDate.toDate(), 
            end: compDate.toDate(), 
              // You can also choose to set an end time
              // If an end time is set, this will take precedence over duration
              // end: new Date('June 15, 2013 23:00'),
            // Event duration (IN MINUTES)
            duration: 60,
              // Event Description
              description: '{{ Comp.comp_description }}'
          }
        });
        document.querySelector('#{{ Comp.comp_record_hash }} .calendar').appendChild(myCalendar);
        //console.log(myCalendar);
        // check if date has passed, add 'past' class to it
        var today = moment();
        if (today.diff(compDate) > 0)
          $('#{{ Comp.comp_record_hash }}').addClass('past');
          {% endif %}

    
  });
      // End: Deadline Control + Calendar

  </script>
{% endblock %}


<!-- 完整的 JavaScript 参考手册：http://www.w3school.com.cn/jsref/index.asp
- JavaScript 本地对象和内置对象
- Browser 对象（BOM）
- HTML DOM 对象 -->

<!-- HTML DOM Style 对象参考手册：http://www.w3school.com.cn/jsref/dom_obj_style.asp -->

<!-- $() = document.getElementById() -->


<!-- https://phantomjscloud.com/api/browser/v2/a-demo-key-with-low-quota-per-ip-address/?request=%7Burl:%22http://iphysresearch.github.io/%22,renderType:%22jpeg%22,renderSettings:%7Bviewport:%7Bwidth:640,height:1000%7D,clipRectangle:%7Bwidth:640,height:1000%7D,zoomFactor:1%7D%7D -->